---
import { getI18N } from '../i18n/';
const { currentLocale, url } = Astro
const i18n = getI18N({ currentLocale })
console.log(url)

let otherUrl;
let newHref : string;

if (url.pathname.includes('/ca')) otherUrl = url.pathname.slice(3)
else if (url.pathname.length === 1)otherUrl = url.pathname.slice(1)
else otherUrl = url.pathname

 if (currentLocale == 'es') newHref = "https://esland-web-urieljolo.vercel.app" + '/ca' + otherUrl
 else newHref = "https://esland-web-urieljolo.vercel.app" + otherUrl
---


<div class="relative group block">
    <div class="bg-black/30 rounded-md text-xs group-hover:bg-black/70 block p-1">
        <button type="button" class="flex justify-start items-center gap-2 px-3 py-1" aria-expanded="true">
            {currentLocale == 'es' ? 
            <img src="spain.png" alt="Bandera España" class="w-3 h-3"></img> : 
            <img src="flag.png" alt="Bandera Catalunya" class="w-3 h-3"></img>
        }
            <span>{currentLocale == 'es' ? "Español" : "Catalá"}</span>
            <svg class="w-3 h-3 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 8">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 5.326 5.7a.909.909 0 0 0 1.348 0L13 1"/>
            </svg>
        </button>
    </div>
    <div class="bg-black/30 hover:bg-black/70 hidden rounded-md text-xs group-hover:animate-fade-down group-hover:absolute group-hover:block w-full p-1 mt-[2px]">
        <a href={newHref} id="language-selector" type="button" class="flex justify-start items-center gap-2 px-3 py-1 w-full" aria-expanded="true">
            {currentLocale == 'ca' ?
            <img src="spain.png" alt="Bandera España" class="w-3 h-3"></img> 
            :
            <img src="flag.png" alt="Bandera Catalunya" class="w-3 h-3"></img>}
            <span>{currentLocale == 'ca' ? "Español" : "Catalá"}</span>
        </a>
    </div>
</div>

<script>
    document.body.addEventListener('DOMContentLoaded', () => {
        const languageSelector = document.getElementById('language-selector')
    
        languageSelector?.addEventListener('click', () => {
            // const newLocale = currentLocale == 'es' ? 'ca' : 'es'
            // i18n.changeLocale(newLocale)
        })
    })
</script>